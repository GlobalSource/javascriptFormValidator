/**
 * Created by shankar on 12/5/17.
 */
class jsValidator{constructor(){this.formData=!1,this.onlyFilter=!1,this.jsForm=!1,this.jsSettings=!1,this.jsFormError=!1,this.formErrorList={},this.jsFilter=!1,this.forceFilter=!1,this.initialLoad=!0,this.option=!1,this.onChange=!1}init(a){return this.jsFilter=new jsFilter(a.forceFilter),jsLogger.table(a),this.option=a,this.onChange=a.onChange,this.jsSettings=(new jsSettings).init(a),this.jsForm=(new jsForm).init(a),this.jsFormError=(new jsFormError).init(),this.jsRuleSets=new jsRuleSets,this.forceFilter=a.forceFilter,this.check(),this.submitListener(this.jsForm.formCore,this),this}submitListener(a,b){!1!==this.onlyFilter&&void 0!==this.onlyFilter||document.querySelector("#"+a).addEventListener("submit",function(a){!1===b.check()&&a.preventDefault()})}update(){let a=this.option;this.jsSettings=(new jsSettings).init(a),this.jsForm=(new jsForm).init(a),this.jsFormError=(new jsFormError).init()}check(){let a=this.jsForm,b=this.formErrorList,c=!1,d=[];return b.input=this.elemLoop("input",a.input),b.textArea=this.elemLoop("textArea",a.textArea),b.select=this.elemLoop("select",a.select),d.push({errorElem:b}),jsLogger.out("Error List",d),0===b.input.length&&0===b.textArea.length&&0===b.select.length&&(alert("Form Valid !"),c=!0),0==this.initialLoad&&validationResponse.init(b,this.option),this.initialLoad=!1,c}elemLoop(a,b){let c=[];if(null===b||void 0===b)return!1;for(let a in b)if(b[a]){let d=b[a];this.applyFilters(d),1==this.onChange&&this.applyGlobalListener(d),!1!==this.onlyFilter&&"undefined"!==this.onlyFilter||(c=this.jsRuleSets.constructor.checkValidation(d,c))}return c}applyFilters(a){"number"==a.type&&this.jsFilter.number(a),"email"==a.type&&this.jsFilter.constructor.email(a),a.getAttribute("data-allow")&&this.jsFilter.string(a),a.getAttribute("pattern")&&jsFilter.pattern(a)}applyGlobalListener(a){var b=this;a.addEventListener("change",b.constructor.quickValidation,!1)}static quickValidation(a){jsLogger.out("Quick",a);var b=[],c=a.target;jsLogger.out("Target",c),b=(new jsRuleSets).constructor.checkValidation(c,b),jsLogger.out("Quick Out",b),validationResponse.process(b)}validate(){return this.check()}}class jsFilter{constructor(a){this.forceFilter=a}number(a){let b=this,c=!0;!1===this.forceFilter&&(c=!1,!0===a.required&&(c=!0)),!0===c&&a.addEventListener("keypress",b.constructor.isNumberKey,!1)}string(a){let b=a.getAttribute("data-allow"),c=this,d=!0;switch(0==this.forceFilter&&(d=!1,!0===a.required&&(d=!0)),b){case"onlyAlpha":!0===d&&a.addEventListener("keypress",c.constructor.isAlpha,!1);break;case"string":!0===d&&a.addEventListener("keypress",c.constructor.isAlphaNumeric,!1);break;case"password":!0===d&&a.addEventListener("keypress",c.constructor.isValidPassword,!1);break;default:!0===d&&a.addEventListener("keypress",c.constructor.isPatternValid,!1)}}static pattern(a){var b=this,c=!0;!1===this.forceFilter&&(c=!1,!0===a.required&&(c=!0)),!0===c&&a.addEventListener("keypress",b.isPatternValid,!1)}static email(a){}limit(a){let b=!0;!1===this.forceFilter&&(b=!1,!0===a.required&&(b=!0)),!0===b&&a.addEventListener("keypress",this.constructor.isInLimit,!1)}static isInLimit(a){let b=a.target.value;if(!0===helper.isWindowAction(a))return!0;let c=a.target.min,d=a.target.max;c||(c=0),d||(d=54);let e=new RegExp("^[0-9]+$"),f=String.fromCharCode(a.charCode?a.charCode:a.which);(!1===e.test(f)||parseInt(b)>d||parseInt(b)<c)&&a.preventDefault(),a.target.value=a.target.value>d?d:a.target.value}static isAlpha(a){if(!0===helper.isWindowAction(a))return!0;let b=pattern.validate(a,"a-zA-Z");console.log(b),!1===b&&a.preventDefault()}static isAlphaNumeric(a){if(!0===helper.isWindowAction(a))return!0;!1===pattern.validate(a,"a-zA-Z0-9")&&a.preventDefault()}static isValidPassword(a){return 32===(a.which?a.which:a.keyCode)?(a.preventDefault(),!1):!0===helper.isWindowAction(a)||void(!1===pattern.validate(a,"a-zA-Z0-9")&&a.preventDefault())}static isPatternValid(a){if(!0===helper.isWindowAction(a))return!0;!1===pattern.validate(a,"a-zA-Z0-9")&&a.preventDefault()}static isNumberKey(a){if(!0===helper.isWindowAction(a))return!0;let b=a.which?a.which:a.keyCode;return!(46===b||b>31&&(b<48||b>57))||(a.preventDefault(),!1)}}class jsSettings{constructor(){this.errorColor=!1,this.errorTemplate=!1}init(a){return this.errorColor=a.errorColor,this.errorTemplate=a.errorTemplate,this}log(){jsLogger.out(this.errorColor),jsLogger.out(this.followedElement),jsLogger.out(this.errorTemplate)}}class jsForm{constructor(){this.options=!1,this.form=!1,this.formCore=!1,this.input=!1,this.select=!1,this.textArea=!1,this.label=!1,this.forceFilter=!1}init(a){return this.options=a,this.forceFilter=a.forceFilter,this.registerForm(a.form),this.parseForm(this.form),this.required(),this}registerForm(a){if(void 0===a&&jsLogger.out("Form Identification","Form Identification is Missing !"),null===a)return!1;this.form=document.getElementById(a),null===this.form&&jsLogger.out("Status 503","Failed to Proceed !"),this.formCore=a}parseForm(a){if(null===a)return!1;this.input=a.getElementsByTagName("input"),this.select=a.getElementsByTagName("select"),this.textArea=a.getElementsByTagName("textarea"),this.label=a.getElementsByTagName("label")}required(){let a=this.forceFilter;this.input=jsField.required(this.input,a),this.select=jsField.required(this.select,a),this.textArea=jsField.required(this.textArea,a)}log(){jsLogger.out("Form",this.form),jsLogger.out("input",this.input),jsLogger.out("select",this.select),jsLogger.out("textarea",this.textArea),jsLogger.out("labels",this.label)}}class jsField{constructor(){this.forceFilter=!1}init(a){this.forceFilter=a.forceFilter}static required(a,b){let c=[];for(let d=0;d<a.length;d++)!0!==a[d].required&&!0!==b||c.push(a[d]);return c}}class jsRuleSets{constructor(){}static checkValidation(a,b){let c=!0,d=!1;if(jsRuleSets.isSet(a)||(b.push({el:a,type:"required",id:a.name+Math.random().toString(36).substring(2)}),0==d&&(d=a)),a.min&&jsRuleSets.isSet(a)&&(jsRuleSets.min(a)||(b.push({el:a,type:"min",id:a.name+Math.random().toString(36).substring(2)}),0==d&&(d=a),c=!1)),a.max&&jsRuleSets.isSet(a)&&(jsRuleSets.max(a)||(b.push({el:a,type:"max",id:a.name+Math.random().toString(36).substring(2)}),0==d&&(d=a),c=!1)),"email"==a.type&&jsRuleSets.isSet(a)&&(jsRuleSets.email(a)||(b.push({el:a,type:"email",id:a.name+Math.random().toString(36).substring(2)}),0==d&&(d=a),c=!1)),"password"==a.type&&jsRuleSets.isSet(a)&&(jsRuleSets.compare(a)||(b.push({el:a,type:"password",id:a.name+Math.random().toString(36).substring(2)}),0==d&&(d=a),c=!1)),!0===c&&(jsLogger.out("Valid Elem",a),""!==a.name)){var e=document.getElementById(a.name);void 0!==e&&null!==e&&(e.innerHTML="")}return!1!==d&&(jsLogger.out("First Hit ",d),helper.scrollToItem(d)),b}static isSet(a){if(!1===a.required)return!0;let b=!0,c=a.value;return 0!==c.length&&""!==c&&" "!==c||(b=!1),b}static min(a){if(!1===a.required)return!0;let b=!0,c=a.value,d=a.min;return c.length<d&&(b=!1),b}static max(a){if(!1===a.required)return!0;let b=!0,c=a.value,d=a.max;return c.length>d&&(b=!1),b}static email(a){if(!1===a.required)return!0;var b=!1,c=a.value;return c=c.toString(),/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(c)&&(b=!0),c||(b=!1),b}static phone(a,b){if(!1===a.required)return!0;let c=!0;return""===a.value&&(c=!1),c}static compare(a){let b=!1;!1===a.required&&(b=!0);let c=a.getAttribute("data-check");if(void 0!==c&&null!=c||(b=!1),null===c&&(c=a.getAttribute("data-parent")),null===c)b=!1;else{c=c.toString();let d=document.getElementById(c);a.value===d.value&&(b=!0)}return jsLogger.out("Compare Status",b),b}}class jsFormError{constructor(){this.errorHit=!1,this.errorCss=!1,this.successCss=!1}init(){this.errorHit=!1,this.errorCss="border-color: red;border-radius: 5px;color: red;",this.successCss="border-color: green;border-radius: 5px;color: green;"}log(){}style(a){this.errorCss=a.error,this.successCss=a.success}}let jsLogger={out:function(a,b){console.log("======"+a+"======"),console.log(b),console.log("------------------------")},bulk:function(a){console.log(a)},table:function(a){console.table(a)}},helper={isWindowAction:function(a){let b=a||window.event,c=b.shiftKey||b.which;return 9===c||0===c||8===c||32===c||13===c||8===c||c>=35&&c<=40||(c=String.fromCharCode(c),0===c.length)},scrollToItem:function(a){let b=a.nodeName;if(!b)return!1;if(null==b)return!1;a=document.getElementsByName(b);var c=(a.offsetTop-window.scrollY)/20;window._lastDiff||(window._lastDiff=0),Math.abs(c)>2?(window.scrollTo(0,window.scrollY+c),clearTimeout(window._TO),c!==window._lastDiff&&(window._lastDiff=c,window._TO=setTimeout(this.scrollToItem,100,a))):window.scrollTo(0,a.offsetTop)}},pattern={getDefault:function(a,b){void 0===b&&(b="");let c=a.target.getAttribute("data-allowSpecial"),d=a.target.pattern;console.log(d.length);return c||null!==c||(c=""),c=c.toString(),""!==d&&d.length>0&&null!==d?d:"^["+b+c+"]+$"},validate:function(a,b){let c=this.getDefault(a,b),d=new RegExp(c),e=String.fromCharCode(a.charCode?a.charCode:a.which);return d.test(e)}},validationResponse={init:function(a,b){this.errorMessage=b.message,this.input(a.input),this.select(a.select),this.textArea(a.textArea)},input:function(a){this.process(a)},select:function(a){this.process(a)},textArea:function(a){this.process(a)},process:function(a){let b="";for(let c in a)if(a[c].el&&!0===a[c].el.required){let d=a[c],e=a[c].type;b=this.template(d,e);let f=document.getElementById(d.id);void 0===f||null===f?(f=document.createElement("span"),f.setAttribute("id",d.id),f.innerHTML=b):f.innerHTML=b,d.el.parentNode.insertBefore(f,d.el.nextSibling)}},template:function(a,b){jsLogger.out("error Type 0",b);let c="",d="",e=a.el.getAttribute("data-message");return void 0!==e&&""!==e&&null!==e||(void 0!==this.errorMessage&&void 0!==this.errorMessage[b]?(b=this.errorMessage[b],a.el.getAttribute("data-message"),b&&(jsLogger.out("errorType",b),d=b,"min"!=a.type&&"max"!=a.type||("min"==a.type&&(c=a.el.min),"max"==a.type&&(c=a.el.max),d=d.replace("[INDEX]",c)))):d=this.default(b),e=d),e},default:function(a){let b={required:"This field is required",min:"This field length is too low.",max:"This field length is exceeds the limit",password:"Password does not match.",email:"Email is not valid"};return"string"==typeof a&&(void 0!==b[a]&&b[a])}};